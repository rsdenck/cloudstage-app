generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

enum NodeType {
  FOLDER
  DOCUMENT
}

enum PublishStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum UserRole {
  ADMIN
  EDITOR
  VIEWER
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  name      String?
  role      UserRole @default(VIEWER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Collection {
  id           String   @id @default(cuid())
  name         String
  description  String?
  slug         String   @unique
  customDomain String?  @unique
  nodes        Node[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Node {
  id           String     @id @default(cuid())
  name         String
  slug         String
  type         NodeType
  parentId     String?
  parent       Node?      @relation("NodeToNode", fields: [parentId], references: [id], onDelete: Cascade)
  children     Node[]     @relation("NodeToNode")
  collectionId String
  collection   Collection @relation(fields: [collectionId], references: [id], onDelete: Cascade)
  position     Int        @default(0)
  document     Document?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([parentId, slug])
}

model Document {
  id            String         @id @default(cuid())
  nodeId        String         @unique
  node          Node           @relation(fields: [nodeId], references: [id], onDelete: Cascade)
  content       String
  status        PublishStatus  @default(DRAFT)
  versions      Version[]
  codeBlocks    CodeBlock[]
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
}

model Version {
  id            String   @id @default(cuid())
  documentId    String
  document      Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  content       String
  versionNumber Int
  createdAt     DateTime @default(now())
}

model CodeBlock {
  id         String   @id @default(cuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id], onDelete: Cascade)
  language   String
  content    String
  createdAt  DateTime @default(now())
}
